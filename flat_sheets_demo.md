# Демонстрация плоской структуры Google Sheets

## Описание изменений

Мы реализовали плоскую структуру для Google Sheets, которая позволяет использовать встроенные возможности Google Sheets для фильтрации и анализа данных по кассам.

## Структура листов

### Лист "Транзакции" (плоская структура)

| Касса   | Дата/Время       | Тип операции  | Принял | Количество | Выдал | Количество | Курс    | Комиссия % | Прибыль | Валюта прибыли | Примечание       | Id    |     | Обновлено:       |
| ------- | ---------------- | ------------- | ------ | ---------- | ----- | ---------- | ------- | ---------- | ------- | -------------- | ---------------- | ----- | --- | ---------------- |
| Прага   | 13.11.2025 10:30 | Фиат → Крипта | USD    | 1000       | BTC   | 0.025      | 40000   | 2          | 50      | USD            |                  | tx123 |     | 13.11.2025 10:30 |
| Украина | 13.11.2025 11:15 | Крипта → Фиат | BTC    | 0.01       | UAH   | 15000      | 1500000 | 1.5        | 225     | UAH            |                  | tx124 |     | 13.11.2025 11:15 |
| Прага   | 13.11.2025 12:00 | Пополнение    | USD    | 2000       |       |            |         |            |         |                | Пополнение кассы | tx125 |     | 13.11.2025 12:00 |

### Лист "Касса" (плоская структура)

| Касса   | Валюта | Баланс   | Обновлено:       |
| ------- | ------ | -------- | ---------------- |
| Прага   | USD    | 5000.00  | 13.11.2025 12:00 |
| Прага   | EUR    | 2500.00  | 13.11.2025 10:45 |
| Прага   | CZK    | 75000.00 | 13.11.2025 09:30 |
| Украина | USD    | 1200.00  | 13.11.2025 11:15 |
| Украина | UAH    | 45000.00 | 13.11.2025 11:15 |

### Лист "Прибыль" (плоская структура)

| Касса   | Валюта | Прибыль | Обновлено:       |
| ------- | ------ | ------- | ---------------- |
| Прага   | USD    | 150.00  | 13.11.2025 12:00 |
| Прага   | EUR    | 75.50   | 13.11.2025 10:45 |
| Украина | UAH    | 1250.00 | 13.11.2025 11:15 |
| Украина | USD    | 45.00   | 13.11.2025 09:00 |

## Как использовать фильтры и сводные таблицы

### 1. Создание выпадающего списка (Data Validation)

В любой ячейке (например, A1 на новом листе "Дашборд"):

- Данные → Проверка данных
- Критерии → Список из диапазона
- Диапазон: `Касса!A2:A` (автоматически обновляется)

### 2. Фильтрация транзакций по выбранной кассе

Формула QUERY для показа транзакций только выбранной кассы:

```
=QUERY(Транзакции!A:M; "SELECT * WHERE A = '" & A1 & "' ORDER BY B DESC")
```

### 3. Показ баланса выбранной кассы

Формула для показа баланса только выбранной кассы:

```
=QUERY(Касса!A:C; "SELECT B, C WHERE A = '" & A1 & "'")
```

### 4. Показ прибыли выбранной кассы

Формула для показа прибыли только выбранной кассы:

```
=QUERY(Прибыль!A:C; "SELECT B, C WHERE A = '" & A1 & "'")
```

### 5. Сводная таблица по всем кассам

Для создания сводной таблицы:

- Вставка → Сводная таблица
- Диапазон: весь лист "Транзакции"
- Строки: Касса, Тип операции
- Значения: Прибыль (СУММА)
- Фильтры: Дата/Время

## Преимущества плоской структуры

1. **Простота фильтрации**: Один клик для переключения между кассами
2. **Встроенные инструменты**: Используются стандартные возможности Google Sheets
3. **Масштабируемость**: Легко добавлять новые кассы
4. **Анализ данных**: Сводные таблицы работают из коробки
5. **Совместимость**: Работает с любыми инструментами импорта/экспорта

## Реализация в API

- `add_transaction()` - добавляет строки с указанием кассы
- `update_balance_for_desk()` - точечно обновляет баланс конкретной кассы/валюты
- `update_profit_for_desk()` - точечно обновляет прибыль конкретной кассы/валюты
- Все функции работают с единными листами вместо создания отдельных листов для каждой кассы
